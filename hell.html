<!DOCTYPE html>
<html>
 <head>
  <meta charset="UTF-8">
  <title>BUBZ</title>
 </head>
 <body>
  
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js" type="text/javascript"></script>
  <script src="pixi.js"></script>
  <script>
    $(function(){
      var w = 1024;
	  var h = 768;
      var speed = 3;
      var balls = [new PIXI.Texture.fromImage("spark.png"),
                   new PIXI.Texture.fromImage("spark2.png"),
                   new PIXI.Texture.fromImage("spark3.png")]

          renderer = PIXI.autoDetectRenderer(w, h);

          stage = new PIXI.Stage;
          
      document.body.appendChild(renderer.view);
      window.Balls = {items: [],mouseX: 512, mouseY: 384,current_i: 0};

      var getRandom = function(){
        return (Math.random() * 3) - 1.5;
      }

      var kill = [];
      wipe = function (obj){
	    for (var p in obj){
		    if (obj.hasOwnProperty(p)) delete obj[p];
	    }
    };
      var timer = function(){
        var now = new Date().getTime(); // get current time
        this.dt = now - this.time; // calculate time since last call
        this.time = now; // update the current application time
        return this.dt || 0 ;
      }
      var update = function(){
        var ball = new PIXI.Sprite(balls[Balls.current_i]);
        var dt = timer()/35;
        ball.position.x = Math.round(Math.random()*w);
        ball.position.y = Math.round(Math.random()*h);
        ball.anchor.x = 0.5;
        ball.anchor.y = 0.5;
        ball.scale.x = 2.0;
        ball.scale.y = 2.0;
        ball.life = 500;
        ball.speed = speed;
        Balls.items.push(ball);
        stage.addChild(ball);
        Balls.current_i = (Balls.current_i + 1) % 3
        
        var mouseX = Balls.mouseX,
            mouseY = Balls.mouseY;

        var length = Balls.items.length, i = 0;

        while(i < length){
          var b = Balls.items[i];
           b.position.x = Math.round(b.position.x + b.speed * Math.random() * dt);
           b.position.y = Math.round(b.position.y + b.speed * Math.random() * dt);
           b.life--;
           if(b.life < 0){
             stage.removeChild(b);
             kill.push(i);
           }
           i++;
         }
        renderer.render(stage);
         _(kill).each(function(k){wipe(Balls.items.splice(k,1)[0])})
        kill.length = 0;
		requestAnimFrame(update);
      }
      update();
    })
  </script>
 </body>
</html>
